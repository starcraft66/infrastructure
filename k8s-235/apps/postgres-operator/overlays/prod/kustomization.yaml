apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
- ../../base

patchesStrategicMerge:
- patches/ingress.yaml

configMapGenerator:
- name: postgres-operator
  behavior: replace
  literals:
  - api_port="8080"
  - aws_region=eu-central-1
  - cluster_domain=cluster.local
  - cluster_history_entries="1000"
  - cluster_labels=application:spilo
  - cluster_name_label=cluster-name
  - connection_pooler_image=registry.opensource.zalan.do/acid/pgbouncer:master-19
  - db_hosted_zone=db.example.com
  - debug_logging="true"
  - docker_image=registry.opensource.zalan.do/acid/spilo-14:2.1-p3
  - enable_ebs_gp3_migration="false"
  - enable_master_load_balancer="false"
  - enable_pgversion_env_var="true"
  - enable_replica_load_balancer="false"
  - enable_spilo_wal_path_compat="true"
  - enable_team_member_deprecation="false"
  - enable_teams_api="false"
  - external_traffic_policy=Cluster
  - logical_backup_docker_image=registry.opensource.zalan.do/acid/logical-backup:v1.7.1
  - logical_backup_job_prefix=logical-backup-
  - logical_backup_provider=s3
  - logical_backup_s3_bucket=my-bucket-url
  - logical_backup_s3_sse=AES256
  - logical_backup_schedule=30 00 * * *
  - major_version_upgrade_mode=manual
  - master_dns_name_format='{cluster}.{team}.{hostedzone}'
  - pdb_name_format=postgres-{cluster}-pdb
  - pod_deletion_wait_timeout=10m
  - pod_label_wait_timeout=10m
  - pod_management_policy=ordered_ready
  - pod_role_label=spilo-role
  - pod_service_account_name=postgres-pod
  - pod_terminate_grace_period=5m
  - ready_wait_interval=3s
  - ready_wait_timeout=30s
  - repair_period=5m
  - replica_dns_name_format='{cluster}-repl.{team}.{hostedzone}'
  - replication_username=standby
  - resource_check_interval=3s
  - resource_check_timeout=10m
  - resync_period=30m
  - ring_log_lines="100"
  - role_deletion_suffix=_deleted
  - secret_name_template='{username}.{cluster}.credentials.{tprkind}.{tprgroup}'
  - spilo_allow_privilege_escalation="true"
  - spilo_privileged="false"
  - storage_resize_mode=pvc
  - super_username=postgres
  - watched_namespace='*'
  - workers="8"
- name: postgres-operator-ui
  literals:
  - APP_URL=https://postgres.k8s.235.tdude.co
  - OPERATOR_API_URL=http://postgres-operator:8080
  - OPERATOR_CLUSTER_NAME_LABEL=cluster-name
  - RESORUCES_VISIBLE="False"
  - TARGET_NAMSEPACE=default
  - TEAMS=["acid"]
  - OPERATOR_UI_CONFIG={"docs_link":"https://postgres-operator.readthedocs.io/en/latest/","dns_format_string":"{1}-{0}.{2}","databases_visible":true,"master_load_balancer_visible":true,"nat_gateways_visible":false,"replica_load_balancer_visible":true,"resources_visible":true,"users_visible":true,"cost_ebs":0.119,"cost_core":0.0575,"cost_memory":0.014375,"postgresql_versions":["14","13","12","11"]}
