---
- name: Create a login user
  user:
    name: tristan
    update_password: on_create
    group: tristan
    uid: 1000
    groups:
      - docker
      - sudo
    state: present
    shell: /bin/bash
    system: no
    createhome: yes
    home: /home/tristan

- name: Install packages
  apt:
    pkg:
      - htop
      - tcpdump
      - python
      - python-pip
    state: present

- name: Enable passwordless sudo
  lineinfile:
    path: /etc/sudoers
    state: present
    line: 'tristan ALL=(ALL:ALL) NOPASSWD: ALL'
    validate: '/usr/sbin/visudo -cf %s'
        
- name: Add login banner
  template:
    src: "issue.j2"
    dest: "/etc/issue.net"
    mode: 0644
    owner: root
    group: root

- name: Enable login banner
  replace:
    path: /etc/ssh/sshd_config
    regexp: '^#Banner\ none'
    replace: 'Banner\ \/etc\/issue.net'
    backup: yes
  notify: reload sshd