apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
- ../../base
- resources/ingress.yaml
- resources/nfs-volume.yaml

images:
- name: photoprism/photoprism
  newTag: "251130"

generators:
- ./generators/secrets-generator.yaml

namespace: photoprism

configMapGenerator:
- literals:
  - PHOTOPRISM_SITE_URL="https://photos.tdude.co/"
  - PHOTOPRISM_ORIGINALS_LIMIT=100000
  - PHOTOPRISM_HTTP_COMPRESSION="gzip"
  - PHOTOPRISM_DEBUG="false"
  - PHOTOPRISM_PUBLIC="false"
  - PHOTOPRISM_READONLY="false"
  - PHOTOPRISM_EXPERIMENTAL="false"
  - PHOTOPRISM_DISABLE_CHOWN="true"
  - PHOTOPRISM_DISABLE_WEBDAV="false"
  - PHOTOPRISM_DISABLE_SETTINGS="false"
  - PHOTOPRISM_DISABLE_TENSORFLOW="false"
  - PHOTOPRISM_DISABLE_FACES="false"
  - PHOTOPRISM_DISABLE_CLASSIFICATION="false"
  - PHOTOPRISM_DARKTABLE_PRESETS="false"
  - PHOTOPRISM_DETECT_NSFW="false"
  - PHOTOPRISM_UPLOAD_NSFW="true"
  # PHOTOPRISM_DATABASE_DRIVER="sqlite"         # SQLite is an embedded database that doesn't require a server
  - PHOTOPRISM_DATABASE_DRIVER="mysql"
  - PHOTOPRISM_DATABASE_SERVER="photoprism-mariadb:3306"
  - PHOTOPRISM_DATABASE_PASSWORD="insecure"
  - PHOTOPRISM_SITE_TITLE="PhotoPrism"
  - PHOTOPRISM_SITE_CAPTION="Browse Your Life"
  - PHOTOPRISM_SITE_DESCRIPTION=""
  - PHOTOPRISM_SITE_AUTHOR=""
  ## Set a non-root user, group, or custom umask if your Docker environment doesn't support this natively:
  - PHOTOPRISM_UID=1000
  - PHOTOPRISM_GID=1000
  - PHOTOPRISM_UMASK=0022
  ## Enable TensorFlow AVX2 support for modern Intel CPUs (requires starting the container as root):
  # - PHOTOPRISM_INIT="tensorflow-amd64-avx2"
  #  Hardware video transcoding config (optional):
  # - PHOTOPRISM_FFMPEG_BUFFERS="64"              # FFmpeg capture buffers (default: 32)
  # - PHOTOPRISM_FFMPEG_BITRATE="32"              # FFmpeg encoding bitrate limit in Mbit/s (default: 50)
  # - PHOTOPRISM_FFMPEG_ENCODER="h264_v4l2m2m"    # Use Video4Linux for AVC transcoding (default: libx264)
  # - PHOTOPRISM_FFMPEG_ENCODER="h264_qsv"        # Use Intel Quick Sync Video for AVC transcoding (default: libx264)
  # - PHOTOPRISM_INIT="intel-graphics tensorflow-amd64-avx2" # Enable TensorFlow AVX2 & Intel Graphics support
  - HOME="/photoprism"
  name: photoprism-config

patches:
- path: ./patches/persistence.yaml
  target:
    group: apps
    kind: StatefulSet
    name: photoprism
    version: v1
